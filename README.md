# Talaty Backend - API de cr√©dit pour PME

![Java](https://img.shields.io/badge/Java-17-orange?style=flat-square&logo=java)
![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.2-brightgreen?style=flat-square&logo=spring)
![MySQL](https://img.shields.io/badge/MySQL-8.0-blue?style=flat-square&logo=mysql)
![MapStruct](https://img.shields.io/badge/MapStruct-1.5.5-red?style=flat-square)
![Maven](https://img.shields.io/badge/Maven-3.9-yellow?style=flat-square&logo=apache-maven)

## üìã Table des mati√®res

- [Vue d'ensemble](#vue-densemble)
- [Fonctionnalit√©s](#fonctionnalit√©s)
- [Architecture](#architecture)
- [Technologies utilis√©es](#technologies-utilis√©es)
- [Pr√©requis](#pr√©requis)
- [Installation](#installation)
- [Configuration](#configuration)
- [Structure du projet](#structure-du-projet)
- [API Endpoints](#api-endpoints)
- [Authentification](#authentification)
- [Documentation API](#documentation-api)
- [Tests](#tests)
- [D√©ploiement](#d√©ploiement)
- [Contribution](#contribution)

## üéØ Vue d'ensemble

**Talaty** est une application backend compl√®te d√©velopp√©e en **Java 17** avec **Spring Boot 3.2** pour faciliter l'acc√®s au cr√©dit pour les Petites et Moyennes Entreprises (PME) au Maroc. L'application offre un syst√®me complet d'eKYC (electronic Know Your Customer), de gestion de documents, et d'√©valuation automatique du cr√©dit.

### Objectifs principaux :
- **Simplifier** le processus de demande de cr√©dit pour les PME
- **Automatiser** l'√©valuation de cr√©dibilit√© via un syst√®me de scoring intelligent
- **S√©curiser** les donn√©es clients avec des protocoles robustes
- **Optimiser** l'exp√©rience utilisateur avec un workflow guid√©

## üöÄ Fonctionnalit√©s

### üîê Authentification & S√©curit√©
- **Authentification multi-canal** : Email/Username + Mot de passe OU Code OTP SMS
- **JWT Tokens** s√©curis√©s avec expiration configurable
- **V√©rification email** avec tokens temporaires
- **Autorisation bas√©e sur les r√¥les** (USER, ADMIN)
- **Hashage des mots de passe** avec BCrypt

### üìÑ Gestion eKYC (Know Your Customer)
- **Formulaire eKYC complet** : Informations personnelles, professionnelles, bancaires
- **Workflow en √©tapes** : DRAFT ‚Üí PENDING ‚Üí UNDER_REVIEW ‚Üí APPROVED/REJECTED
- **Calcul automatique** du pourcentage de compl√©tion du profil
- **Prochaines √©tapes dynamiques** selon la progression utilisateur

### üìÅ Gestion de Documents
- **Upload multi-fichiers** vers Cloudinary (PDF, Images)
- **Types de documents** : CIN, Passeport, Registre Commerce, Relev√©s bancaires
- **Extraction automatique** de donn√©es (simulation OCR)
- **V√©rification** et validation par les administrateurs
- **M√©tadonn√©es compl√®tes** pour chaque document

### ‚öñÔ∏è Syst√®me de Scoring Intelligent
- **Algorithme sur 100 points** bas√© sur :
    - Informations entreprise (30 points)
    - Donn√©es financi√®res (25 points)
    - Documents soumis (25 points)
    - Coh√©rence des donn√©es (20 points)
- **Recalcul automatique** √† chaque modification
- **Scoring final** par les administrateurs

### üë®‚Äçüíº Interface Administrateur
- **Dashboard des demandes** en attente
- **Workflow de validation** : Examiner ‚Üí Approuver/Rejeter
- **V√©rification de documents** avec commentaires
- **Historique des d√©cisions** et audit trail

### üîî Syst√®me de Notifications
- **Notifications en temps r√©el** pour les utilisateurs
- **Multi-canal** : Base de donn√©es + Email
- **Types de notifications** : Soumission, Validation, Rejet
- **Marquage lu/non lu** avec compteurs

### üìß Services de Communication
- **Envoi d'emails** automatis√© (V√©rification, OTP, Notifications)
- **Templates HTML** personnalis√©s et responsive
- **Gestion des √©checs** d'envoi avec retry logic

## üèóÔ∏è Architecture

### Pattern d'architecture
- **Architecture en couches** (Controller ‚Üí Service ‚Üí Repository ‚Üí Entity)
- **Mapping automatique** avec MapStruct
- **R√©ponses standardis√©es** avec ApiResponse<T>
- **Gestion d'erreurs centralis√©e** avec @ControllerAdvice

### S√©curit√©
```
Requ√™te ‚Üí JWT Filter ‚Üí Security Config ‚Üí Controller ‚Üí Service ‚Üí Repository ‚Üí Database
```

### Workflow eKYC
```
Inscription ‚Üí V√©rification Email ‚Üí Compl√©tion eKYC ‚Üí Upload Documents ‚Üí 
Soumission ‚Üí Review Admin ‚Üí D√©cision finale ‚Üí Notification utilisateur
```

## üõ†Ô∏è Technologies utilis√©es

### Backend Core
- **Java 17** - Version LTS avec performances optimis√©es
- **Spring Boot 3.2** - Framework principal
- **Spring Security 6** - Authentification et autorisation
- **Spring Data JPA** - Couche de persistance
- **Hibernate** - ORM avec g√©n√©ration automatique des tables

### Base de donn√©es
- **MySQL 8.0** - Base de donn√©es principale
- **MariaDB Dialect** - Optimisations sp√©cifiques

### Mapping et Validation
- **MapStruct 1.5.5** - Mapping automatique Entity ‚Üî DTO
- **Hibernate Validator** - Validation des donn√©es d'entr√©e
- **Jakarta Validation** - Annotations de validation

### S√©curit√© et Tokens
- **JWT (JSON Web Tokens)** - Authentification stateless
- **BCrypt** - Hashage s√©curis√© des mots de passe
- **UUID** - G√©n√©ration de tokens uniques

### Services externes
- **Cloudinary** - Stockage et transformation d'images/documents
- **JavaMail** - Envoi d'emails avec templates HTML
- **Simulation SMS** - Service OTP (pr√™t pour int√©gration Twilio/AWS SNS)

### Documentation et Tests
- **Swagger/OpenAPI 3** - Documentation API interactive
- **JUnit 5** - Tests unitaires
- **Spring Boot Test** - Tests d'int√©gration
- **TestContainers** - Tests avec base de donn√©es

### Build et D√©ploiement
- **Maven 3.9** - Gestion des d√©pendances et build
- **Spring Boot Actuator** - Monitoring et m√©triques
- **Logback** - Logging configurable

## üìã Pr√©requis

### Environnement de d√©veloppement
- **Java 17** ou sup√©rieur
- **Maven 3.9+**
- **MySQL 8.0** ou **MariaDB 10.6+**
- **IDE** recommand√© : IntelliJ IDEA ou Eclipse

### Comptes de service
- **Compte Cloudinary** (gratuit) pour le stockage de fichiers
- **Serveur SMTP** pour l'envoi d'emails (Gmail, SendGrid, etc.)

### Outils optionnels
- **Docker** pour conteneurisation
- **Postman** pour tester les APIs
- **MySQL Workbench** pour la gestion de base de donn√©es

## ‚öôÔ∏è Installation

### 1. Cloner le repository
```bash
git clone https://github.com/your-org/talaty-backend.git
cd talaty-backend
```

### 2. Configuration de la base de donn√©es
```sql
-- Cr√©er la base de donn√©es
CREATE DATABASE talaty_db1 CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- Cr√©er un utilisateur d√©di√© (optionnel)
CREATE USER 'talaty_user'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON talaty_db1.* TO 'talaty_user'@'localhost';
FLUSH PRIVILEGES;
```

### 3. Installer les d√©pendances
```bash
mvn clean install
```

### 4. Configuration des variables d'environnement
Cr√©er un fichier `.env` ou configurer les variables syst√®me :

```bash
# Base de donn√©es
DB_USERNAME=talaty_user
DB_PASSWORD=your_db_password

# Cloudinary
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret

# JWT
JWT_SECRET=your-super-secret-jwt-key-minimum-256-bits
JWT_EXPIRATION=86400000

# Email SMTP
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-app-password

# Application
FRONTEND_URL=http://localhost:3000
SERVER_PORT=8080
OTP_EXPIRATION=5
OTP_LENGTH=6
EMAIL_VERIFICATION_EXPIRATION=24
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION=30
```

### 5. Lancer l'application
```bash
# Mode d√©veloppement
mvn spring-boot:run

# Ou avec le JAR
mvn clean package
java -jar target/talaty-0.0.1-SNAPSHOT.jar
```

### 6. V√©rifier l'installation
- **API Health Check** : http://localhost:8080/actuator/health
- **Documentation Swagger** : http://localhost:8080/swagger-ui.html
- **API Docs JSON** : http://localhost:8080/api-docs

## üîß Configuration

### Configuration Spring Boot (application.yml)

L'application utilise le profil de configuration suivant pour une flexibilit√© maximale :

```yaml
spring:
  application:
    name: talaty
  
  # Base de donn√©es avec cr√©ation automatique
  datasource:
    url: jdbc:mysql://localhost:3306/talaty_db1?createDatabaseIfNotExist=true
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
  
  # JPA/Hibernate avec DDL automatique
  jpa:
    hibernate:
      ddl-auto: update  # Cr√©ation/mise √† jour automatique des tables
    show-sql: true     # Affichage des requ√™tes SQL (dev uniquement)
  
  # Configuration email SMTP
  mail:
    host: ${MAIL_HOST}
    port: ${MAIL_PORT}
    username: ${MAIL_USERNAME}
    password: ${MAIL_PASSWORD}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
  
  # CORS pour frontend
  web:
    cors:
      allowed-origins: ${FRONTEND_URL}
      allowed-methods: "GET, POST, PUT, DELETE, OPTIONS"
      allowed-headers: "Authorization, Content-Type"
      allow-credentials: true
  
  # Upload de fichiers (max 10MB)
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB

# Configuration JWT s√©curis√©e
security:
  jwt:
    secret-key: ${JWT_SECRET}
    expiration-time: ${JWT_EXPIRATION}

# Configuration OTP
otp:
  expiration-minutes: ${OTP_EXPIRATION}
  length: ${OTP_LENGTH}
```

### Variables d'environnement requises

| Variable | Description | Exemple | Requis |
|----------|-------------|---------|--------|
| `DB_USERNAME` | Utilisateur MySQL | `talaty_user` | ‚úÖ |
| `DB_PASSWORD` | Mot de passe MySQL | `password123` | ‚úÖ |
| `CLOUDINARY_CLOUD_NAME` | Nom du cloud Cloudinary | `my-cloud` | ‚úÖ |
| `CLOUDINARY_API_KEY` | Cl√© API Cloudinary | `123456789012345` | ‚úÖ |
| `CLOUDINARY_API_SECRET` | Secret API Cloudinary | `abcdef...` | ‚úÖ |
| `JWT_SECRET` | Cl√© secr√®te JWT (min 256 bits) | `your-secret-key` | ‚úÖ |
| `JWT_EXPIRATION` | Dur√©e de vie JWT (ms) | `86400000` | ‚úÖ |
| `MAIL_HOST` | Serveur SMTP | `smtp.gmail.com` | ‚úÖ |
| `MAIL_PORT` | Port SMTP | `587` | ‚úÖ |
| `MAIL_USERNAME` | Email d'envoi | `app@company.com` | ‚úÖ |
| `MAIL_PASSWORD` | Mot de passe email | `app-password` | ‚úÖ |
| `FRONTEND_URL` | URL du frontend | `http://localhost:3000` | ‚úÖ |
| `SERVER_PORT` | Port du serveur | `8080` | ‚ùå |
| `OTP_EXPIRATION` | Dur√©e OTP (minutes) | `5` | ‚ùå |

## üìÅ Structure du projet

```
src/main/java/com/talaty/
‚îú‚îÄ‚îÄ üìÅ config/              # Configurations Spring
‚îÇ   ‚îú‚îÄ‚îÄ ApplicationConfiguration.java
‚îÇ   ‚îú‚îÄ‚îÄ CloudinaryConfig.java
‚îÇ   ‚îú‚îÄ‚îÄ JwtAuthenticationFilter.java
‚îÇ   ‚îú‚îÄ‚îÄ SecurityConfiguration.java
‚îÇ   ‚îú‚îÄ‚îÄ SwaggerConfig.java
‚îÇ   ‚îî‚îÄ‚îÄ WebConfig.java
‚îÇ
‚îú‚îÄ‚îÄ üìÅ controller/          # Contr√¥leurs REST
‚îÇ   ‚îú‚îÄ‚îÄ AdminEKYCController.java
‚îÇ   ‚îú‚îÄ‚îÄ AuthenticationController.java
‚îÇ   ‚îú‚îÄ‚îÄ DocumentController.java
‚îÇ   ‚îú‚îÄ‚îÄ EKYCController.java
‚îÇ   ‚îú‚îÄ‚îÄ NotificationController.java
‚îÇ   ‚îî‚îÄ‚îÄ UserController.java
‚îÇ
‚îú‚îÄ‚îÄ üìÅ dto/                 # Data Transfer Objects
‚îÇ   ‚îú‚îÄ‚îÄ ApiResponse.java
‚îÇ   ‚îú‚îÄ‚îÄ LoginRequest.java
‚îÇ   ‚îú‚îÄ‚îÄ LoginResponse.java
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ request/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdminRequestDto.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CustomerRequestDto.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DocumentUploadDto.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EKYCRequestDto.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OTPRequestDto.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ OTPVerifyDto.java
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ response/
‚îÇ       ‚îú‚îÄ‚îÄ AdminResponseDto.java
‚îÇ       ‚îú‚îÄ‚îÄ CustomerResponseDto.java
‚îÇ       ‚îú‚îÄ‚îÄ DocumentResponseDto.java
‚îÇ       ‚îú‚îÄ‚îÄ EKYCResponseDto.java
‚îÇ       ‚îú‚îÄ‚îÄ MediaResponseDto.java
‚îÇ       ‚îú‚îÄ‚îÄ NotificationResponseDto.java
‚îÇ       ‚îî‚îÄ‚îÄ OTPResponseDto.java
‚îÇ
‚îú‚îÄ‚îÄ üìÅ enums/               # √ânum√©rations
‚îÇ   ‚îú‚îÄ‚îÄ ApplicationStatus.java
‚îÇ   ‚îú‚îÄ‚îÄ DocumentType.java
‚îÇ   ‚îú‚îÄ‚îÄ MediaType.java
‚îÇ   ‚îî‚îÄ‚îÄ Role.java
‚îÇ
‚îú‚îÄ‚îÄ üìÅ exception/           # Gestion des exceptions
‚îÇ   ‚îú‚îÄ‚îÄ GlobalExceptionHandler.java
‚îÇ   ‚îî‚îÄ‚îÄ FileUploadException.java
‚îÇ
‚îú‚îÄ‚îÄ üìÅ mapper/              # MapStruct Mappers
‚îÇ   ‚îú‚îÄ‚îÄ AdminReviewMapper.java
‚îÇ   ‚îú‚îÄ‚îÄ DocumentMapper.java
‚îÇ   ‚îú‚îÄ‚îÄ EKYCMapper.java
‚îÇ   ‚îú‚îÄ‚îÄ MediaMapper.java
‚îÇ   ‚îú‚îÄ‚îÄ NotificationMapper.java
‚îÇ   ‚îú‚îÄ‚îÄ OTPMapper.java
‚îÇ   ‚îî‚îÄ‚îÄ UserMapper.java
‚îÇ
‚îú‚îÄ‚îÄ üìÅ model/               # Entit√©s JPA
‚îÇ   ‚îú‚îÄ‚îÄ Admin.java
‚îÇ   ‚îú‚îÄ‚îÄ Customer.java
‚îÇ   ‚îú‚îÄ‚îÄ Document.java
‚îÇ   ‚îú‚îÄ‚îÄ EKYC.java
‚îÇ   ‚îú‚îÄ‚îÄ Media.java
‚îÇ   ‚îú‚îÄ‚îÄ Notification.java
‚îÇ   ‚îî‚îÄ‚îÄ User.java (abstract)
‚îÇ
‚îú‚îÄ‚îÄ üìÅ repository/          # Repositories Spring Data
‚îÇ   ‚îú‚îÄ‚îÄ AdminRepository.java
‚îÇ   ‚îú‚îÄ‚îÄ CustomerRepository.java
‚îÇ   ‚îú‚îÄ‚îÄ DocumentRepository.java
‚îÇ   ‚îú‚îÄ‚îÄ EKYCRepository.java
‚îÇ   ‚îú‚îÄ‚îÄ MediaRepository.java
‚îÇ   ‚îú‚îÄ‚îÄ NotificationRepository.java
‚îÇ   ‚îî‚îÄ‚îÄ UserRepository.java
‚îÇ
‚îú‚îÄ‚îÄ üìÅ service/             # Services m√©tier
‚îÇ   ‚îú‚îÄ‚îÄ AdminEKYCService.java
‚îÇ   ‚îú‚îÄ‚îÄ AuthenticationService.java
‚îÇ   ‚îú‚îÄ‚îÄ DocumentService.java
‚îÇ   ‚îú‚îÄ‚îÄ EKYCService.java
‚îÇ   ‚îú‚îÄ‚îÄ EmailService.java
‚îÇ   ‚îú‚îÄ‚îÄ JwtService.java
‚îÇ   ‚îú‚îÄ‚îÄ MediaService.java
‚îÇ   ‚îú‚îÄ‚îÄ MediaUploadService.java
‚îÇ   ‚îú‚îÄ‚îÄ NotificationService.java
‚îÇ   ‚îú‚îÄ‚îÄ OTPService.java
‚îÇ   ‚îú‚îÄ‚îÄ ScoringService.java
‚îÇ   ‚îî‚îÄ‚îÄ UserService.java
‚îÇ
‚îú‚îÄ‚îÄ üìÅ util/                # Utilitaires
‚îÇ   ‚îú‚îÄ‚îÄ FileUploadUtil.java
‚îÇ   ‚îî‚îÄ‚îÄ UserDetailsServiceImp.java
‚îÇ
‚îî‚îÄ‚îÄ TalatyApplication.java  # Classe principale
```

## üåê API Endpoints

### üîê Authentification (`/api/auth`)

| M√©thode | Endpoint | Description | Auth requis |
|---------|----------|-------------|-------------|
| `POST` | `/signup` | Inscription utilisateur | ‚ùå |
| `POST` | `/login` | Connexion classique | ‚ùå |
| `POST` | `/add-admin` | Cr√©er administrateur | ADMIN |
| `GET` | `/verify-email` | V√©rifier email | ‚ùå |
| `POST` | `/resend-verification` | Renvoyer email v√©rification | ‚ùå |
| `GET` | `/next-steps` | Prochaines √©tapes utilisateur | USER |

### üì± OTP (`/api/auth/otp`)

| M√©thode | Endpoint | Description | Auth requis |
|---------|----------|-------------|-------------|
| `POST` | `/send` | Envoyer code OTP | ‚ùå |
| `POST` | `/verify` | V√©rifier OTP + Connexion | ‚ùå |

### üìÑ eKYC (`/api/ekyc`)

| M√©thode | Endpoint | Description | Auth requis |
|---------|----------|-------------|-------------|
| `POST` | `/` | Cr√©er/Modifier eKYC | USER |
| `GET` | `/me` | Mon eKYC | USER |
| `POST` | `/{id}/submit` | Soumettre eKYC | USER |

### üìÅ Documents (`/api/documents`)

| M√©thode | Endpoint | Description | Auth requis |
|---------|----------|-------------|-------------|
| `POST` | `/upload` | Upload documents | USER |
| `GET` | `/ekyc/{id}` | Documents d'un eKYC | USER |

### üîî Notifications (`/api/notifications`)

| M√©thode | Endpoint | Description | Auth requis |
|---------|----------|-------------|-------------|
| `GET` | `/` | Mes notifications | USER |
| `GET` | `/unread` | Notifications non lues | USER |
| `GET` | `/unread/count` | Nombre non lues | USER |
| `PUT` | `/{id}/read` | Marquer comme lue | USER |
| `PUT` | `/mark-all-read` | Tout marquer lu | USER |

### üë®‚Äçüíº Administration (`/api/admin`)

| M√©thode | Endpoint | Description | Auth requis |
|---------|----------|-------------|-------------|
| `GET` | `/ekyc/pending` | eKYCs en attente | ADMIN |
| `GET` | `/ekyc/status/{status}` | eKYCs par statut | ADMIN |
| `PUT` | `/ekyc/{id}/review` | Traiter une demande | ADMIN |
| `PUT` | `/document/{id}/verify` | V√©rifier document | ADMIN |

## üîê Authentification

### JWT Token
```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### R√©ponse de connexion
```json
{
  "success": true,
  "message": "Connexion r√©ussie",
  "data": {
    "token": "eyJ...",
    "expirationTime": 86400000,
    "role": "USER",
    "userId": 1,
    "fullName": "Mouhcine TEMSAMANI",
    "verified": false,
    "phoneVerified": true,
    "emailVerified": true,
    "profileCompletion": 75.0,
    "nextSteps": [
      "Informations sur votre entreprise",
      "T√©l√©chargement de documents"
    ]
  }
}
```

### Workflow d'authentification

1. **Inscription** ‚Üí V√©rification email requise
2. **Connexion classique** ‚Üí Username/Email + Password
3. **Connexion OTP** ‚Üí Num√©ro + Code SMS (+ Email si v√©rifi√©)
4. **Token JWT** ‚Üí Valable 24h par d√©faut
5. **Next Steps** ‚Üí Guidage selon progression

## üìö Documentation API

### Swagger UI
Une documentation interactive compl√®te est disponible √† :
- **URL** : http://localhost:8080/swagger-ui.html
- **JSON** : http://localhost:8080/api-docs

### Exemples de requ√™tes

#### Inscription d'un utilisateur
```bash
curl -X POST http://localhost:8080/api/auth/signup \
  -H "Content-Type: application/json" \
  -d '{
    "firstName": "Mouhcine",
    "lastName": "TEMSAMANI", 
    "username": "mouhcine",
    "email": "mouhcine@example.com",
    "phone": "+212665858585",
    "password": "Password123!"
  }'
```

#### Connexion OTP
```bash
# 1. Demander un code OTP
curl -X POST http://localhost:8080/api/auth/otp/send \
  -H "Content-Type: application/json" \
  -d '{"phone": "+212665858585"}'

# 2. V√©rifier le code OTP
curl -X POST http://localhost:8080/api/auth/otp/verify \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "+212665858585",
    "otpCode": "123456"
  }'
```

#### Upload de documents
```bash
curl -X POST http://localhost:8080/api/documents/upload \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -F "ekycId=1" \
  -F "documentType=COMPANY_REGISTRATION" \
  -F "documentName=Registre de Commerce" \
  -F "files=@document1.pdf" \
  -F "files=@document2.jpg"
```

## üß™ Tests

### Structure des tests
```
src/test/java/com/talaty/
‚îú‚îÄ‚îÄ üìÅ integration/         # Tests d'int√©gration
‚îÇ   ‚îú‚îÄ‚îÄ AuthenticationFlowTest.java
‚îÇ   ‚îú‚îÄ‚îÄ EKYCWorkflowTest.java
‚îÇ   ‚îî‚îÄ‚îÄ DocumentUploadTest.java
‚îú‚îÄ‚îÄ üìÅ service/             # Tests unitaires services
‚îÇ   ‚îú‚îÄ‚îÄ AuthenticationServiceTest.java
‚îÇ   ‚îú‚îÄ‚îÄ EKYCServiceTest.java
‚îÇ   ‚îî‚îÄ‚îÄ ScoringServiceTest.java
‚îî‚îÄ‚îÄ üìÅ controller/          # Tests contr√¥leurs
    ‚îú‚îÄ‚îÄ AuthControllerTest.java
    ‚îî‚îÄ‚îÄ EKYCControllerTest.java
```

### Ex√©cuter les tests
```bash
# Tous les tests
mvn test

# Tests sp√©cifiques
mvn test -Dtest=AuthenticationServiceTest
mvn test -Dtest="*Integration*"

# Tests avec couverture
mvn test jacoco:report
```

### Tests avec base de donn√©es
Les tests utilisent une base H2 en m√©moire pour l'isolation :

```yaml
# application-test.yml
spring:
  datasource:
    url: jdbc:h2:mem:testdb
    driver-class-name: org.h2.Driver
  jpa:
    hibernate:
      ddl-auto: create-drop
```

## üöÄ D√©ploiement

### Build de production
```bash
# Package JAR optimis√©
mvn clean package -Pprod

# Skip tests pour d√©ploiement rapide
mvn clean package -DskipTests
```

### Variables d'environnement de production
```bash
# Base de donn√©es
DB_USERNAME=talaty_prod
DB_PASSWORD=secure_prod_password

# JWT avec cl√© forte
JWT_SECRET=your-super-secure-256-bit-production-secret-key
JWT_EXPIRATION=86400000

# Email production
MAIL_HOST=smtp.sendgrid.net
MAIL_USERNAME=apikey
MAIL_PASSWORD=your-sendgrid-api-key

# Cloudinary production
CLOUDINARY_CLOUD_NAME=talaty-prod
# ... autres configs prod
```

### Dockerfile (optionnel)
```dockerfile
FROM openjdk:17-jdk-slim

WORKDIR /app
COPY target/talaty-*.jar app.jar

EXPOSE 8080

ENV JAVA_OPTS="-Xmx512m -Xms256m"
ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]
```

### Docker Compose
```yaml
version: '3.8'
services:
  talaty-backend:
    build: .
    ports:
      - "8080:8080"
    environment:
      - DB_USERNAME=talaty
      - DB_PASSWORD=password
      # ... autres variables
    depends_on:
      - mysql

  mysql:
    image: mysql:8.0
    environment:
      MYSQL_DATABASE: talaty_db1
      MYSQL_USER: talaty
      MYSQL_PASSWORD: password
      MYSQL_ROOT_PASSWORD: rootpass
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql

volumes:
  mysql_data:
```

## üèóÔ∏è Architecture de d√©ploiement recommand√©e

### Environnement de production
```
[Frontend] ‚Üí [Load Balancer] ‚Üí [Talaty Backend] ‚Üí [MySQL Master]
                                      ‚Üì              ‚Üì
                              [Cloudinary]    [MySQL Slave (Read)]
                                      ‚Üì
                              [Email Service]
```

### Monitoring et observabilit√©
- **Spring Boot Actuator** : M√©triques et health checks
- **Logs structur√©s** : Format JSON pour parsing
- **Prometheus** : Collecte de m√©triques (optionnel)
- **Grafana** : Dashboards de monitoring (optionnel)

## ü§ù Contribution

### Standards de d√©veloppement
- **Java 17** avec features modernes
- **Code style** : Google Java Style Guide
- **Tests** : Couverture minimale 80%
- **Documentation** : Javadoc pour m√©thodes publiques
- **Git** : Conventional Commits

### Workflow de contribution
1. **Fork** le repository
2. **Cr√©er branch** : `feature/nouvelle-fonctionnalite`
3. **D√©velopper** avec tests
4. **Commit** : `feat: ajouter syst√®me de scoring avanc√©`
5. **Pull Request** avec description d√©taill√©e

### Structure des commits
```
feat: ajouter authentification OTP
fix: corriger validation email
docs: mettre √† jour README API
test: ajouter tests int√©gration eKYC
refactor: optimiser mappers MapStruct
```

## üìù Changelog

### Version 1.0.0 (2025-01-17)
- ‚úÖ Authentification JWT + OTP
- ‚úÖ Syst√®me eKYC complet
- ‚úÖ Upload documents Cloudinary
- ‚úÖ Scoring automatique
- ‚úÖ Interface admin
- ‚úÖ Notifications multi-canal
- ‚úÖ MapStruct integration
- ‚úÖ Documentation Swagger

## üìû Support

### Contacts
- **Email** : support@talaty.ma
- **Documentation** : https://docs.talaty.ma
- **Issues** : GitHub Issues

### FAQ

**Q: Comment configurer l'envoi d'emails en local ?**
R: Utiliser un serveur SMTP de test comme MailHog ou un compte Gmail avec app password.

**Q: Puis-je utiliser PostgreSQL au lieu de MySQL ?**
R: Oui, modifier le driver et dialect dans application.yml.

**Q: Comment activer le vrai service SMS pour OTP ?**
R: Int√©grer Twilio ou AWS SNS dans OTPService.sendSMS().

**Q: Comment personnaliser l'algorithme de scoring ?**
R: Modifier ScoringService.calculateInitialScore() selon vos crit√®res.

---

## üéØ Roadmap

### Prochaines fonctionnalit√©s
- [ ] API Analytics et rapports
- [ ] Int√©gration Twilio pour SMS r√©els
- [ ] Cache Redis pour performances
- [ ] API Rate Limiting
- [ ] Webhook syst√®me pour int√©grations externes
- [ ] Support multi-langues (i18n)
- [ ] Audit logs complets

---

**D√©velopp√© avec ‚ù§Ô∏è pour faciliter l'acc√®s au cr√©dit des PME marocaines**

![Talaty](https://img.shields.io/badge/Talaty-Backend-blue?style=for-the-badge)